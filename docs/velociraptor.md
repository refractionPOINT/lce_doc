# Velociraptor

## Overview
The Velociraptor service allows you to perform [Velociraptor](https://github.com/Velocidex/Velociraptor)
deployment and artifact gathering at scale directly from LimaCharlie.

The interface defines 3 main actions:
1. `list` to list all the possible Velociraptor artifacts it can collect (we always run the latest release).
1. `show` to show the arguments and general usage information for a given Velociraptor artifact type.
1. `collect` to run the Velociraptor artifact collection on a number of endpoints.

Once generated by Velociraptor, the artifact (a zip file with all collected data) is ingested automatically
into LimaCharlie's Artifact system where you can download it.

The download from LimaCharlie process can also be automated using an Output with the Artifact stream tipping
you off whenever a `velociraptor` Artifact is ingested into LimaCharlie. You can then export the Artifact
using a REST API call.

## Actions

### list
This action takes no parameters and it returns the list of velociraptor artifacts synchronously.

### show
This action requires the `artifact_name` parameter to be specified. It returns the artifact's usage synchronously.

### collect
This action requires an artifact specification and an endpoint specification.

An optional `ttl` parameter will define how long (in seconds) the service will wait for a targetted endpoint to come online
and be processed for collection.

#### Artifact Spec
One of the `artifact_name` or `custom_artifact` needs to be specified. The `artifact_name` is the exact name
as defined by Velociraptor. It can also be a comma-separated list of Velociraptor artifacts to collect.

The `custom_artifact` is the content of a custom Velociraptor YAML artifact definition to execute instead
of a pre-defined Velociraptor artifact.

Note that the resulting artifact zip file is only automatically collected when you specify the `artifact_name`
parameter since we can not predict where/how the `custom_artifact` will store its output.

An `args` parameter specifies a comma-separated list of arguments in the format `ARG_NAME=ARG_VALUE` given to
Velociraptor at collection time.

#### Endpoint Spec
One of `sid` or `tag` needs to be specified. If `sid` is specified, the sensor with the Sensor ID specified will
be targetted for collection. If `tag` is specified, _all_ sensors with the given `tag` will be targetted.

### REST

#### collect
```json
{
  "action": "collect",
  "artifact_name": "Windows.Applications.Chrome.Extensions",
  "tag": "server",
  "ttl": 86400
}
```
